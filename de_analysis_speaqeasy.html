<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2020-07-10" />

<title>SPEAQeasy Differential Expression Analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">

</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="/usr/local/lib/R/host-site-library/BiocStyle/resources/html/bioconductor.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 828px;
  margin-left: auto;
  margin-right: auto;
}

img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




<script>
function toggle_visibility(id1) {
  var e = document.getElementById(id1);
  e.style.display = ((e.style.display!="none") ? "none" : "block");
}
</script>

</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SPEAQeasy example</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="prepare_data.html">Download Example Data</a>
</li>
<li>
  <a href="run_speaqeasy.html">Run SPEAQeasy</a>
</li>
<li>
  <a href="swap_speaqeasy.html">Resolve Sample Identities</a>
</li>
<li>
  <a href="de_analysis_speaqeasy.html">Differential Expression</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lcolladotor/twitter-stats">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">SPEAQeasy Differential Expression Analysis</h1>
<h4 class="date">July 10, 2020</h4>

</div>

<h1>Contents</h1>
<div id="TOC">
<ul>
<li><a href="#analysis"><span class="toc-section-number">1</span> Analysis</a><ul>
<li><a href="#load-required-libraries"><span class="toc-section-number">1.1</span> Load required libraries</a></li>
<li><a href="#load-data-and-prepare-directories-to-place-outputs-in"><span class="toc-section-number">1.2</span> Load data and prepare directories to place outputs in</a></li>
<li><a href="#statistics-pcs"><span class="toc-section-number">1.3</span> statistics PCs</a></li>
<li><a href="#stats-vs.-race-and-brain-region"><span class="toc-section-number">1.4</span> Stats vs. race and brain region</a></li>
<li><a href="#explore-and-visualize-gene-expression"><span class="toc-section-number">1.5</span> Explore and visualize gene expression</a></li>
<li><a href="#modeling"><span class="toc-section-number">1.6</span> Modeling</a></li>
<li><a href="#check-plots"><span class="toc-section-number">1.7</span> Check plots</a></li>
<li><a href="#gene-ontology"><span class="toc-section-number">1.8</span> Gene ontology</a></li>
<li><a href="#visualize-differentially-expressed-genes"><span class="toc-section-number">1.9</span> Visualize differentially expressed genes</a></li>
</ul></li>
</ul>
</div>

<div id="analysis" class="section level1">
<h1><span class="header-section-number">1</span> Analysis</h1>
<p>The following analysis explores a <code>RangedSummarizedExperiment</code> object from the SPEAQeasy pipeline. Note that we will use a modified version of the object, which resolved sample identity issues which were present in the raw output from SPEAQeasy. This object also includes phenotype data added after resolving identity issues. Though SPEAQeasy produces objects for several feature types (genes, exons, exon-exon junctions), we will demonstrate an example analysis for just genes. We will perform differential expression across some typical variables of interest (e.g. sex, age, race) and show how to perform principal component analysis (PCA) and visualize findings with plots.</p>
<div id="load-required-libraries" class="section level2">
<h2><span class="header-section-number">1.1</span> Load required libraries</h2>
<pre class="r"><code>library(&quot;SummarizedExperiment&quot;)
library(&quot;recount&quot;)
library(&quot;edgeR&quot;)
library(&quot;limma&quot;)
library(&quot;jaffelab&quot;) # GitHub: LieberInstitute/jaffelab
library(&quot;RColorBrewer&quot;)
library(&quot;clusterProfiler&quot;)
library(&quot;org.Hs.eg.db&quot;)
library(&quot;pheatmap&quot;)
library(&quot;here&quot;)</code></pre>
</div>
<div id="load-data-and-prepare-directories-to-place-outputs-in" class="section level2">
<h2><span class="header-section-number">1.2</span> Load data and prepare directories to place outputs in</h2>
<p>For those who ran SPEAQeasy from the example FASTQ data set, the <code>RangedSummarizedExperiment</code> will have a different path, as specified with the <code>--output</code> flag.</p>
<pre class="r"><code># Load the RSE gene object
load(here(&quot;rse_speaqeasy.RData&quot;), verbose = TRUE)</code></pre>
<pre><code>## Loading objects:
##   rse_gene</code></pre>
<pre class="r"><code># Create directories to organize outputs from this analysis
dir.create(here(&quot;DE_analysis&quot;, &quot;pdfs&quot;), showWarnings = FALSE)
dir.create(here(&quot;DE_analysis&quot;, &quot;tables&quot;), showWarnings = FALSE)
dir.create(here(&quot;DE_analysis&quot;, &quot;rdas&quot;), showWarnings = FALSE)</code></pre>
</div>
<div id="statistics-pcs" class="section level2">
<h2><span class="header-section-number">1.3</span> statistics PCs</h2>
<p>Here we are using principal component analysis to control for the listed variables impact on expression. This will be later added into our linear model.</p>
<pre class="r"><code>col_names = c(&#39;trimmed&#39;, &#39;numReads&#39;, &#39;numMapped&#39;, &#39;numUnmapped&#39;, 
              &#39;overallMapRate&#39;, &#39;concordMapRate&#39;, &#39;totalMapped&#39;, &#39;mitoMapped&#39;,
              &#39;mitoRate&#39;, &#39;totalAssignedGene&#39;)
statsPca = prcomp(as.data.frame(colData(rse_gene)[,col_names]))
rse_gene$PC = statsPca$x[,1]
getPcaVars(statsPca)[1]</code></pre>
<pre><code>## [1] 87.3</code></pre>
</div>
<div id="stats-vs.-race-and-brain-region" class="section level2">
<h2><span class="header-section-number">1.4</span> Stats vs. race and brain region</h2>
<pre class="r"><code># Filter for expressed
rse_gene = rse_gene[rowMeans(getRPKM(rse_gene,&quot;Length&quot;)) &gt; 0.2,]

# Check if certain statistics changed by race or region
pdf(file = here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;Region_Race_cellcheck.pdf&quot;))
boxplot(rse_gene$rRNA_rate ~ rse_gene$BrainRegion,xlab=&quot;&quot;)
boxplot(rse_gene$mitoRate ~ rse_gene$BrainRegion,xlab=&quot;&quot;)
boxplot(rse_gene$gene_Assigned ~ rse_gene$BrainRegion,xlab=&quot;&quot;)
boxplot(rse_gene$mitoRate ~ rse_gene$Race,las=3,xlab=&quot;&quot;)
boxplot(rse_gene$gene_Assigned ~ rse_gene$Race,las=3,xlab=&quot;&quot;)
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
</div>
<div id="explore-and-visualize-gene-expression" class="section level2">
<h2><span class="header-section-number">1.5</span> Explore and visualize gene expression</h2>
<pre class="r"><code># Explore gene expression
geneExprs = log2(getRPKM(rse_gene,&quot;Length&quot;)+1)
pca = prcomp(t(geneExprs))
pca_vars = getPcaVars(pca)
pca_vars_lab = paste0(&quot;PC&quot;, seq(along=pca_vars), &quot;: &quot;,
    pca_vars, &quot;% Var Expl&quot;)


# Set up plots
pdf(here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;PCA_plotsExprs.pdf&quot;), w=9)
par(mar=c(8,6,2,2),cex.axis=1.8,cex.lab=1.8)
palette(brewer.pal(4,&quot;Dark2&quot;))

# PC1 vs. PC2
plot(pca$x, pch=21, bg=factor(rse_gene$PrimaryDx),cex=1.2,
    xlab = pca_vars_lab[1], ylab = pca_vars_lab[2])
legend(&quot;bottomleft&quot;, levels(rse_gene$PrimaryDx), col=1:2, pch=15,cex=2)


# By line
for(i in 1:10) {
    boxplot(pca$x[,i] ~ rse_gene$Sex,
        ylab=pca_vars_lab[i], las = 3,xlab=&quot;Sex&quot;,outline=FALSE)
    points( pca$x[,i] ~ jitter(as.numeric(factor(rse_gene$Sex))),
        pch = 21, bg = rse_gene$PrimaryDx,cex=1.2)
}

# By experiment
for(i in 1:10) {
    boxplot(pca$x[,i] ~ rse_gene$Race,
        ylab=pca_vars_lab[i], las = 3,xlab=&quot;Race&quot;,outline=FALSE)
    points( pca$x[,i] ~ jitter(as.numeric(factor(rse_gene$Race))),
        pch = 21, bg = rse_gene$PrimaryDx,cex=1.2)
}
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
</div>
<div id="modeling" class="section level2">
<h2><span class="header-section-number">1.6</span> Modeling</h2>
<pre class="r"><code>dge = DGEList(counts = assays(rse_gene)$counts,
    genes = rowData(rse_gene))
dge = calcNormFactors(dge)

# Mean-variance
mod = model.matrix(~PrimaryDx + PC + BrainRegion,
    data=colData(rse_gene))
pdf(file = &quot;DE_analysis/pdfs/vGene.pdf&quot;)
vGene = voom(dge,mod,plot=TRUE)</code></pre>
<pre><code>## Coefficients not estimable: PrimaryDxOther</code></pre>
<pre><code>## Warning: Partial NA coefficients for 26708 probe(s)</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code># Get duplicate correlation
gene_dupCorr = duplicateCorrelation(vGene$E, mod,
    block=colData(rse_gene)$SAMPLE_ID)</code></pre>
<pre><code>## Coefficients not estimable: PrimaryDxOther</code></pre>
<pre class="r"><code>save(gene_dupCorr, file = here(&quot;DE_analysis&quot;, &quot;rdas&quot;, &quot;gene_dupCorr_neurons.rda&quot;))

# Fit linear model
fitGeneDupl = lmFit(vGene,
    correlation=gene_dupCorr$consensus.correlation,
    block=colData(rse_gene)$SAMPLEID)</code></pre>
<pre><code>## Coefficients not estimable: PrimaryDxOther</code></pre>
<pre><code>## Warning: Partial NA coefficients for 26708 probe(s)</code></pre>
<pre class="r"><code># Here we perform an empirical Bayesian calculation to obtain our significant genes
ebGeneDupl = eBayes(fitGeneDupl)</code></pre>
<pre><code>## Warning in .ebayes(fit = fit, proportion = proportion, stdev.coef.lim = stdev.coef.lim, : Estimation of var.prior failed - set to
## default value</code></pre>
<pre class="r"><code>outGeneDupl = topTable(ebGeneDupl,coef=2,
    p.value = 1,number=nrow(rse_gene),sort=&quot;none&quot;)

pdf(file = here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;hist_pval.pdf&quot;))
hist(outGeneDupl$P.Value)
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>table(outGeneDupl$adj.P.Val &lt; 0.05)</code></pre>
<pre><code>## 
## FALSE  TRUE 
## 26707     1</code></pre>
<pre class="r"><code>table(outGeneDupl$adj.P.Val &lt; 0.1)</code></pre>
<pre><code>## 
## FALSE  TRUE 
## 26706     2</code></pre>
<pre class="r"><code>sigGeneDupl =  topTable(ebGeneDupl,coef=2,
    p.value = 0.1,number=nrow(rse_gene))

sigGeneDupl[,c(&quot;Symbol&quot;,&quot;logFC&quot;, &quot;P.Value&quot;,&quot;AveExpr&quot;)]</code></pre>
<pre><code>##                   Symbol      logFC      P.Value   AveExpr
## ENSG00000269699.6   ZIM2 -1.1238665 1.448916e-06 0.8970203
## ENSG00000126368.6  NR1D1 -0.7637626 6.833687e-06 4.6128957</code></pre>
<pre class="r"><code>sigGeneDupl[sigGeneDupl$logFC &gt; 0,c(&quot;Symbol&quot;,&quot;logFC&quot;, &quot;P.Value&quot;)]</code></pre>
<pre><code>## [1] Symbol  logFC   P.Value
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<pre class="r"><code>sigGeneDupl[sigGeneDupl$logFC &lt;  0,c(&quot;Symbol&quot;,&quot;logFC&quot;, &quot;P.Value&quot;)]</code></pre>
<pre><code>##                   Symbol      logFC      P.Value
## ENSG00000269699.6   ZIM2 -1.1238665 1.448916e-06
## ENSG00000126368.6  NR1D1 -0.7637626 6.833687e-06</code></pre>
<pre class="r"><code>write.csv(outGeneDupl, file = here(&quot;DE_analysis&quot;, &quot;tables&quot;, &quot;de_stats_allExprs.csv&quot;))
write.csv(sigGeneDupl, file = here(&quot;DE_analysis&quot;, &quot;tables&quot;, &quot;de_stats_fdr10_sorted.csv&quot;))</code></pre>
</div>
<div id="check-plots" class="section level2">
<h2><span class="header-section-number">1.7</span> Check plots</h2>
<pre class="r"><code>exprs = vGene$E[rownames(sigGeneDupl),]

# Make boxplots
pdf(here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;DE_boxplots_byDiagnosis.pdf&quot;), w=10)
par(mar=c(8,6,4,2),cex.axis=1.8,cex.lab=1.8, cex.main=1.8)
palette(brewer.pal(4,&quot;Dark2&quot;))

for(i in 1:nrow(sigGeneDupl)) {
    yy = exprs[i,]
    boxplot(yy ~ rse_gene$PrimaryDx, outline=FALSE,
        ylim=range(yy), ylab=&quot;Normalized log2 Exprs&quot;, xlab=&quot;&quot;,
        main = paste(sigGeneDupl$Symbol[i], &quot;-&quot;, sigGeneDupl$gencodeID[i]))
    points(yy ~ jitter(as.numeric(rse_gene$PrimaryDx)),
        pch = 21, bg= rse_gene$PrimaryDx,cex=1.3)
    ll = ifelse(sigGeneDupl$logFC[i] &gt; 0, &quot;topleft&quot;, &quot;topright&quot;)
    legend(ll, paste0(&quot;p=&quot;, signif(sigGeneDupl$P.Value[i],3)), cex=1.3)
}
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>e = geneExprs[rownames(sigGeneDupl),]

pdf(here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;DE_boxplots_byGenome_log2RPKM.pdf&quot;), w=10)
par(mar=c(8,6,4,2),cex.axis=1.8,cex.lab=1.8, cex.main=1.8)
palette(brewer.pal(4,&quot;Dark2&quot;))
for(i in 1:nrow(sigGeneDupl)) {
    yy = e[i,]
    boxplot(yy ~ rse_gene$PrimaryDx, las=3,outline=FALSE,
        ylim=range(yy), ylab=&quot;log2(RPKM+1)&quot;, xlab=&quot;&quot;,
        main = paste(sigGeneDupl$Symbol[i], &quot;-&quot;, sigGeneDupl$gencodeID[i]))
    points(yy ~ jitter(as.numeric(rse_gene$PrimaryDx)),
        pch = 21, bg= rse_gene$PrimaryDx,cex=1.3)
    ll = ifelse(sigGeneDupl$logFC[i] &gt; 0, &quot;topleft&quot;, &quot;topright&quot;)
    legend(ll, paste0(&quot;p=&quot;, signif(sigGeneDupl$P.Value[i],3)), cex=1.3)
}
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
</div>
<div id="gene-ontology" class="section level2">
<h2><span class="header-section-number">1.8</span> Gene ontology</h2>
<p><code>clusterProfiler</code> is a gene ontology package we will use to see if our genes are specifically differentially expressed in certain pathways.</p>
<pre class="r"><code># Get significant genes by sign
sigGene = outGeneDupl[outGeneDupl$P.Value &lt; 0.005,]
sigGeneList = split(as.character(sigGene$EntrezID), sign(sigGene$logFC))
sigGeneList = lapply(sigGeneList, function(x) x[!is.na(x)])
geneUniverse = as.character(outGeneDupl$EntrezID)
geneUniverse = geneUniverse[!is.na(geneUniverse)]

# Do GO and KEGG
goBP_Adj &lt;- compareCluster(sigGeneList, fun = &quot;enrichGO&quot;,
    universe = geneUniverse, OrgDb = org.Hs.eg.db,
    ont = &quot;BP&quot;, pAdjustMethod = &quot;BH&quot;, pvalueCutoff  = 1,
    qvalueCutoff  = 1,  readable= TRUE)

goMF_Adj &lt;- compareCluster(sigGeneList, fun = &quot;enrichGO&quot;,
    universe = geneUniverse, OrgDb = org.Hs.eg.db,
    ont = &quot;MF&quot;, pAdjustMethod = &quot;BH&quot;, pvalueCutoff  = 1,
    qvalueCutoff  = 1,  readable= TRUE)

goCC_Adj &lt;- compareCluster(sigGeneList, fun = &quot;enrichGO&quot;,
    universe = geneUniverse, OrgDb = org.Hs.eg.db,
    ont = &quot;CC&quot;, pAdjustMethod = &quot;BH&quot;, pvalueCutoff  = 1,
    qvalueCutoff  = 1,  readable= TRUE)

kegg_Adj &lt;- compareCluster(sigGeneList, fun = &quot;enrichKEGG&quot;,
    universe = geneUniverse,  pAdjustMethod = &quot;BH&quot;,
    pvalueCutoff  = 1, qvalueCutoff  = 1)

save(goBP_Adj, goCC_Adj, goMF_Adj, kegg_Adj,
    file = here(&quot;DE_analysis&quot;, &quot;rdas&quot;, &quot;gene_set_objects_p005.rda&quot;))

goList = list(BP = goBP_Adj, MF = goMF_Adj, CC = goCC_Adj, KEGG = kegg_Adj)
goDf = dplyr::bind_rows(lapply(goList, as.data.frame), .id = &quot;Ontology&quot;)
goDf = goDf[order(goDf$pvalue),]

write.csv(goDf, file = here(&quot;DE_analysis&quot;, &quot;tables&quot;, &quot;geneSet_output.csv&quot;), row.names=FALSE)

options(width=130)
goDf[goDf$p.adjust &lt; 0.05, c(1:5,7)]</code></pre>
<pre><code>##      Ontology Cluster         ID                                                                  Description GeneRatio
## 1311       BP       1 GO:0032640                                             tumor necrosis factor production      9/84
## 1312       BP       1 GO:0071706                        tumor necrosis factor superfamily cytokine production      9/84
## 1313       BP       1 GO:0050865                                                regulation of cell activation     14/84
## 1314       BP       1 GO:0032611                                                interleukin-1 beta production      7/84
## 1315       BP       1 GO:0032612                                                     interleukin-1 production      7/84
## 1316       BP       1 GO:0032680                               regulation of tumor necrosis factor production      8/84
## 1317       BP       1 GO:1903555          regulation of tumor necrosis factor superfamily cytokine production      8/84
## 1318       BP       1 GO:0032651                                  regulation of interleukin-1 beta production      6/84
## 1319       BP       1 GO:0050867                                       positive regulation of cell activation     10/84
## 1320       BP       1 GO:0002521                                                    leukocyte differentiation     12/84
## 1321       BP       1 GO:0002694                                           regulation of leukocyte activation     12/84
## 1322       BP       1 GO:0032652                                       regulation of interleukin-1 production      6/84
## 1323       BP       1 GO:0009617                                                        response to bacterium     12/84
## 1324       BP       1 GO:0042742                                                defense response to bacterium      7/84
## 1325       BP       1 GO:0071346                                        cellular response to interferon-gamma      7/84
## 1326       BP       1 GO:0050900                                                          leukocyte migration     10/84
## 3316       MF       1 GO:0045028                    G protein-coupled purinergic nucleotide receptor activity      3/88
## 1327       BP       1 GO:0002687                                   positive regulation of leukocyte migration      6/84
## 1328       BP       1 GO:0034341                                                 response to interferon-gamma      7/84
## 3317       MF       1 GO:0046935                           1-phosphatidylinositol-3-kinase regulator activity      3/88
## 1329       BP       1 GO:0031347                                               regulation of defense response     12/84
## 1330       BP       1 GO:0002685                                            regulation of leukocyte migration      7/84
## 1331       BP       1 GO:0071219                            cellular response to molecule of bacterial origin      7/84
## 1332       BP       1 GO:0032760                      positive regulation of tumor necrosis factor production      5/84
## 1333       BP       1 GO:1903975                                           regulation of glial cell migration      3/84
## 1334       BP       1 GO:1903557 positive regulation of tumor necrosis factor superfamily cytokine production      5/84
## 1335       BP       1 GO:0032635                                                     interleukin-6 production      6/84
## 1336       BP       1 GO:0006909                                                                 phagocytosis      8/84
## 1337       BP       1 GO:0032609                                                  interferon-gamma production      5/84
## 1338       BP       1 GO:0042116                                                        macrophage activation      5/84
## 3318       MF       1 GO:0035014                             phosphatidylinositol 3-kinase regulator activity      3/88
## 1339       BP       1 GO:0002696                                  positive regulation of leukocyte activation      8/84
## 1340       BP       1 GO:0050702                                                 interleukin-1 beta secretion      4/84
## 1341       BP       1 GO:0060216                                                       definitive hemopoiesis      3/84
## 3319       MF       1 GO:0001614                                      purinergic nucleotide receptor activity      3/88
## 3320       MF       1 GO:0016502                                                 nucleotide receptor activity      3/88
## 1342       BP       1 GO:0071216                                         cellular response to biotic stimulus      7/84
## 3321       MF       1 GO:0004930                                          G protein-coupled receptor activity      9/88
## 1343       BP       1 GO:0050701                                                      interleukin-1 secretion      4/84
## 1344       BP       1 GO:0043032                                 positive regulation of macrophage activation      3/84
## 1345       BP       1 GO:0050901                                               leukocyte tethering or rolling      3/84
## 1346       BP       1 GO:0032729                           positive regulation of interferon-gamma production      4/84
## 1347       BP       1 GO:0006911                                                     phagocytosis, engulfment      4/84
## 1348       BP       1 GO:0070098                                         chemokine-mediated signaling pathway      4/84
## 1349       BP       1 GO:0007599                                                                   hemostasis      8/84
## 1350       BP       1 GO:0032691                         negative regulation of interleukin-1 beta production      3/84
## 3137       MF      -1 GO:0070888                                                                E-box binding      3/41
## 1351       BP       1 GO:0032692                              negative regulation of interleukin-1 production      3/84
## 1352       BP       1 GO:0001819                                   positive regulation of cytokine production      9/84
## 1353       BP       1 GO:0031349                                      positive regulation of defense response      8/84
## 1354       BP       1 GO:0050766                                          positive regulation of phagocytosis      4/84
## 3871     KEGG       1   hsa04061                Viral protein interaction with cytokine and cytokine receptor      4/46
## 1355       BP       1 GO:0043410                                          positive regulation of MAPK cascade     10/84
## 1356       BP       1 GO:0071222                                      cellular response to lipopolysaccharide      6/84
## 1357       BP       1 GO:0099024                                                 plasma membrane invagination      4/84
## 1358       BP       1 GO:1990868                                                        response to chemokine      4/84
## 1359       BP       1 GO:1990869                                               cellular response to chemokine      4/84
## 1360       BP       1 GO:0032637                                                     interleukin-8 production      4/84
## 1361       BP       1 GO:0050729                                 positive regulation of inflammatory response      5/84
## 1362       BP       1 GO:0050718                          positive regulation of interleukin-1 beta secretion      3/84
## 1363       BP       1 GO:0032675                                       regulation of interleukin-6 production      5/84
## 1364       BP       1 GO:0035590                             purinergic nucleotide receptor signaling pathway      3/84
## 1365       BP       1 GO:0050716                               positive regulation of interleukin-1 secretion      3/84
## 1366       BP       1 GO:0032103                         positive regulation of response to external stimulus      9/84
## 1367       BP       1 GO:0002831                                    regulation of response to biotic stimulus      8/84
## 1368       BP       1 GO:0002275                          myeloid cell activation involved in immune response     10/84
## 1369       BP       1 GO:0030851                                                  granulocyte differentiation      3/84
## 1370       BP       1 GO:2000403                                  positive regulation of lymphocyte migration      3/84
## 1371       BP       1 GO:0002573                                            myeloid leukocyte differentiation      6/84
## 1372       BP       1 GO:0010324                                                        membrane invagination      4/84
## 1373       BP       1 GO:0061756                              leukocyte adhesion to vascular endothelial cell      3/84
## 1374       BP       1 GO:0032649                                    regulation of interferon-gamma production      4/84
## 3872     KEGG       1   hsa04060                                       Cytokine-cytokine receptor interaction      6/46
## 3322       MF       1 GO:0005126                                                    cytokine receptor binding      6/88
## 1375       BP       1 GO:0032496                                               response to lipopolysaccharide      7/84
## 1376       BP       1 GO:1903532                                     positive regulation of secretion by cell      8/84
## 1377       BP       1 GO:0072676                                                         lymphocyte migration      4/84
## 1378       BP       1 GO:0007159                                                 leukocyte cell-cell adhesion      7/84
## 1379       BP       1 GO:0032755                              positive regulation of interleukin-6 production      4/84
## 1380       BP       1 GO:0002237                                     response to molecule of bacterial origin      7/84
## 1381       BP       1 GO:0002683                                 negative regulation of immune system process      8/84
## 1382       BP       1 GO:1905521                                           regulation of macrophage migration      3/84
## 1383       BP       1 GO:0007596                                                            blood coagulation      7/84
## 1384       BP       1 GO:0050817                                                                  coagulation      7/84
## 1385       BP       1 GO:0050706                                   regulation of interleukin-1 beta secretion      3/84
## 1386       BP       1 GO:0051047                                             positive regulation of secretion      8/84
## 1387       BP       1 GO:0042035                                  regulation of cytokine biosynthetic process      4/84
## 1388       BP       1 GO:0050764                                                   regulation of phagocytosis      4/84
## 1389       BP       1 GO:0001774                                                   microglial cell activation      3/84
## 1390       BP       1 GO:0002269                       leukocyte activation involved in inflammatory response      3/84
## 1391       BP       1 GO:0030225                                                   macrophage differentiation      3/84
## 1392       BP       1 GO:0050704                                        regulation of interleukin-1 secretion      3/84
## 3323       MF       1 GO:0000978        RNA polymerase II cis-regulatory region sequence-specific DNA binding      9/88
## 1393       BP       1 GO:0030335                                        positive regulation of cell migration      9/84
## 3324       MF       1 GO:0005525                                                                  GTP binding      8/88
## 1394       BP       1 GO:0030099                                                 myeloid cell differentiation      8/84
## 1395       BP       1 GO:0072604                                                      interleukin-6 secretion      3/84
## 3325       MF       1 GO:0032550                                                purine ribonucleoside binding      8/88
## 3326       MF       1 GO:0001883                                                    purine nucleoside binding      8/88
## 3327       MF       1 GO:0032549                                                       ribonucleoside binding      8/88
## 1396       BP       1 GO:0008217                                                 regulation of blood pressure      5/84
## 1397       BP       1 GO:0042089                                                cytokine biosynthetic process      4/84
## 1398       BP       1 GO:0042107                                                   cytokine metabolic process      4/84
## 3328       MF       1 GO:0000987                          cis-regulatory region sequence-specific DNA binding      9/88
## 1399       BP       1 GO:1902105                                      regulation of leukocyte differentiation      6/84
## 1400       BP       1 GO:0045766                                          positive regulation of angiogenesis      5/84
## 1401       BP       1 GO:2000147                                         positive regulation of cell motility      9/84
## 1402       BP       1 GO:0002363                                         alpha-beta T cell lineage commitment      2/84
## 1403       BP       1 GO:0150078                            positive regulation of neuroinflammatory response      2/84
## 1404       BP       1 GO:0033003                                           regulation of mast cell activation      3/84
## 3329       MF       1 GO:0001882                                                           nucleoside binding      8/88
## 1405       BP       1 GO:0032731                         positive regulation of interleukin-1 beta production      3/84
## 3330       MF       1 GO:0019001                                                    guanyl nucleotide binding      8/88
## 3331       MF       1 GO:0032561                                                guanyl ribonucleotide binding      8/88
## 1406       BP       1 GO:0001818                                   negative regulation of cytokine production      6/84
## 1407       BP       1 GO:0048863                                                    stem cell differentiation      6/84
## 1408       BP       1 GO:0043030                                          regulation of macrophage activation      3/84
## 1409       BP       1 GO:0002697                                        regulation of immune effector process      7/84
## 1410       BP       1 GO:0040017                                            positive regulation of locomotion      9/84
## 1411       BP       1 GO:0043369           CD4-positive or CD8-positive, alpha-beta T cell lineage commitment      2/84
## 1412       BP       1 GO:0098883                                                              synapse pruning      2/84
## 1413       BP       1 GO:0051272                           positive regulation of cellular component movement      9/84
## 3332       MF       1 GO:0070888                                                                E-box binding      3/88
## 1414       BP       1 GO:0097529                                                  myeloid leukocyte migration      5/84
## 1415       BP       1 GO:0043300                                        regulation of leukocyte degranulation      3/84
## 1416       BP       1 GO:0002244                                hematopoietic progenitor cell differentiation      5/84
## 1417       BP       1 GO:0002703                                    regulation of leukocyte mediated immunity      5/84
## 1418       BP       1 GO:0070374                                 positive regulation of ERK1 and ERK2 cascade      5/84
## 3333       MF       1 GO:0048020                                               CCR chemokine receptor binding      2/88
## 1419       BP       1 GO:1903708                                           positive regulation of hemopoiesis      5/84
## 1420       BP       1 GO:0032732                              positive regulation of interleukin-1 production      3/84
## 1421       BP       1 GO:1905517                                                         macrophage migration      3/84
## 1422       BP       1 GO:0070372                                          regulation of ERK1 and ERK2 cascade      6/84
## 1423       BP       1 GO:1903037                                   regulation of leukocyte cell-cell adhesion      6/84
## 1424       BP       1 GO:0071692                                 protein localization to extracellular region      9/84
## 1425       BP       1 GO:0045088                                         regulation of innate immune response      6/84
## 1426       BP       1 GO:0061900                                                        glial cell activation      3/84
## 1427       BP       1 GO:0010919                        regulation of inositol phosphate biosynthetic process      2/84
## 1428       BP       1 GO:0033004                                  negative regulation of mast cell activation      2/84
## 1429       BP       1 GO:0060100                              positive regulation of phagocytosis, engulfment      2/84
## 1430       BP       1 GO:1905155                                 positive regulation of membrane invagination      2/84
## 1431       BP       1 GO:0050878                                              regulation of body fluid levels      8/84
## 1432       BP       1 GO:0002761                              regulation of myeloid leukocyte differentiation      4/84
## 1433       BP       1 GO:1904018                               positive regulation of vasculature development      5/84
## 1434       BP       1 GO:0008347                                                         glial cell migration      3/84
## 1435       BP       1 GO:0043551                         regulation of phosphatidylinositol 3-kinase activity      3/84
## 1436       BP       1 GO:0072678                                                             T cell migration      3/84
## 3334       MF       1 GO:0019955                                                             cytokine binding      4/88
## 1437       BP       1 GO:0001562                                                        response to protozoan      2/84
## 1438       BP       1 GO:0042832                                                defense response to protozoan      2/84
## 1439       BP       1 GO:0060099                                       regulation of phagocytosis, engulfment      2/84
## 1440       BP       1 GO:1903978                                     regulation of microglial cell activation      2/84
## 1441       BP       1 GO:2000401                                           regulation of lymphocyte migration      3/84
## 1442       BP       1 GO:0043270                                         positive regulation of ion transport      6/84
## 1443       BP       1 GO:0042108                         positive regulation of cytokine biosynthetic process      3/84
## 1444       BP       1 GO:0070371                                                        ERK1 and ERK2 cascade      6/84
## 1445       BP       1 GO:0002790                                                            peptide secretion      9/84
## 1446       BP       1 GO:0002360                                                    T cell lineage commitment      2/84
## 1447       BP       1 GO:0042104                        positive regulation of activated T cell proliferation      2/84
## 1448       BP       1 GO:1905153                                          regulation of membrane invagination      2/84
## 1449       BP       1 GO:0002886                            regulation of myeloid leukocyte mediated immunity      3/84
## 1450       BP       1 GO:0045765                                                   regulation of angiogenesis      6/84
## 1451       BP       1 GO:0032677                                       regulation of interleukin-8 production      3/84
## 1452       BP       1 GO:0045123                                                       cellular extravasation      3/84
## 1453       BP       1 GO:0050727                                          regulation of inflammatory response      6/84
## 1454       BP       1 GO:0002577                            regulation of antigen processing and presentation      2/84
## 1455       BP       1 GO:0150146                                                    cell junction disassembly      2/84
## 1456       BP       1 GO:0006954                                                        inflammatory response      9/84
## 1457       BP       1 GO:0031663                                lipopolysaccharide-mediated signaling pathway      3/84
##            pvalue
## 1311 4.442846e-08
## 1312 5.955807e-08
## 1313 2.042035e-07
## 1314 2.762117e-07
## 1315 4.846558e-07
## 1316 5.291141e-07
## 1317 6.457953e-07
## 1318 2.297132e-06
## 1319 2.349005e-06
## 1320 3.605350e-06
## 1321 3.605350e-06
## 1322 3.637541e-06
## 1323 6.604984e-06
## 1324 9.663583e-06
## 1325 2.188166e-05
## 1326 2.555242e-05
## 3316 3.086309e-05
## 1327 3.901699e-05
## 1328 3.938836e-05
## 3317 4.223712e-05
## 1329 4.302992e-05
## 1330 4.665008e-05
## 1331 4.862740e-05
## 1332 5.573978e-05
## 1333 6.417224e-05
## 1334 6.438378e-05
## 1335 6.633435e-05
## 1336 7.418961e-05
## 1337 7.924753e-05
## 1338 8.474696e-05
## 3318 9.186960e-05
## 1339 9.207168e-05
## 1340 9.843140e-05
## 1341 1.011745e-04
## 3319 1.142974e-04
## 3320 1.142974e-04
## 1342 1.169372e-04
## 3321 1.277876e-04
## 1343 1.320556e-04
## 1344 1.498475e-04
## 1345 1.498475e-04
## 1346 1.586476e-04
## 1347 1.733017e-04
## 1348 1.733017e-04
## 1349 2.032086e-04
## 1350 2.116152e-04
## 3137 2.187705e-04
## 1351 2.478391e-04
## 1352 2.514522e-04
## 1353 2.564692e-04
## 1354 2.825185e-04
## 3871 2.923628e-04
## 1355 2.986591e-04
## 1356 3.212669e-04
## 1357 3.279249e-04
## 1358 3.279249e-04
## 1359 3.279249e-04
## 1360 3.783360e-04
## 1361 3.798024e-04
## 1362 4.321639e-04
## 1363 4.766011e-04
## 1364 4.888890e-04
## 1365 4.888890e-04
## 1366 4.971077e-04
## 1367 5.110894e-04
## 1368 5.390682e-04
## 1369 5.501749e-04
## 1370 5.501749e-04
## 1371 5.551129e-04
## 1372 5.626928e-04
## 1373 6.161675e-04
## 1374 6.754461e-04
## 3872 7.205888e-04
## 3322 7.359591e-04
## 1375 7.424577e-04
## 1376 7.846042e-04
## 1377 8.033448e-04
## 1378 8.182442e-04
## 1379 8.495298e-04
## 1380 9.655090e-04
## 1381 9.791509e-04
## 1382 1.021620e-03
## 1383 1.034691e-03
## 1384 1.082942e-03
## 1385 1.118743e-03
## 1386 1.143604e-03
## 1387 1.166745e-03
## 1388 1.166745e-03
## 1389 1.330039e-03
## 1390 1.330039e-03
## 1391 1.330039e-03
## 1392 1.330039e-03
## 3323 1.337238e-03
## 1393 1.367487e-03
## 3324 1.384455e-03
## 1394 1.431051e-03
## 1395 1.444451e-03
## 3325 1.493956e-03
## 3326 1.580520e-03
## 3327 1.580520e-03
## 1396 1.596835e-03
## 1397 1.632240e-03
## 1398 1.632240e-03
## 3328 1.632513e-03
## 1399 1.635117e-03
## 1400 1.649303e-03
## 1401 1.654766e-03
## 1402 1.677685e-03
## 1403 1.677685e-03
## 1404 1.691385e-03
## 3329 1.798052e-03
## 1405 1.824131e-03
## 3330 1.830975e-03
## 3331 1.830975e-03
## 1406 1.942791e-03
## 1407 1.942791e-03
## 1408 1.963208e-03
## 1409 2.003158e-03
## 1410 2.018912e-03
## 1411 2.042202e-03
## 1412 2.042202e-03
## 1413 2.049387e-03
## 3332 2.051128e-03
## 1414 2.052809e-03
## 1415 2.108721e-03
## 1416 2.115847e-03
## 1417 2.180288e-03
## 1418 2.180288e-03
## 3333 2.213958e-03
## 1419 2.246151e-03
## 1420 2.260772e-03
## 1421 2.260772e-03
## 1422 2.292524e-03
## 1423 2.346125e-03
## 1424 2.374893e-03
## 1425 2.400666e-03
## 1426 2.419462e-03
## 1427 2.440725e-03
## 1428 2.440725e-03
## 1429 2.440725e-03
## 1430 2.440725e-03
## 1431 2.485301e-03
## 1432 2.602808e-03
## 1433 2.748562e-03
## 1434 2.757143e-03
## 1435 2.757143e-03
## 1436 2.757143e-03
## 3334 2.788894e-03
## 1437 2.872826e-03
## 1438 2.872826e-03
## 1439 2.872826e-03
## 1440 2.872826e-03
## 1441 2.936322e-03
## 1442 3.000153e-03
## 1443 3.122514e-03
## 1444 3.132401e-03
## 1445 3.149398e-03
## 1446 3.338079e-03
## 1447 3.338079e-03
## 1448 3.338079e-03
## 1449 3.516285e-03
## 1450 3.629843e-03
## 1451 3.724031e-03
## 1452 3.724031e-03
## 1453 3.782205e-03
## 1454 3.836064e-03
## 1455 3.836064e-03
## 1456 3.902893e-03
## 1457 3.939125e-03</code></pre>
</div>
<div id="visualize-differentially-expressed-genes" class="section level2">
<h2><span class="header-section-number">1.9</span> Visualize differentially expressed genes</h2>
<p>Here we visualize DEGs with a heatmap.</p>
<pre class="r"><code>exprs_heatmap = vGene$E[rownames(sigGene),]

df &lt;- as.data.frame(colData(rse_gene)[,c(&quot;PrimaryDx&quot;)])
rownames(df) &lt;- colnames(exprs_heatmap)
colnames(df)&lt;-&quot;diagnosis&quot;

pdf(file=here(&quot;DE_analysis&quot;, &quot;pdfs&quot;, &quot;de_heatmap.pdf&quot;))
pheatmap(exprs_heatmap, cluster_rows=TRUE, show_rownames=FALSE,
         cluster_cols=TRUE, annotation_col=df)
dev.off()</code></pre>
<pre><code>## pdf 
##   3</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      styles: {
        ".MathJax_Display": {
           "text-align": "center",
           padding: "0px 150px 0px 65px",
           margin: "0px 0px 0.5em"
        },
        "@media screen and (max-width: 991px)": {
            ".MathJax_Display": {
               "text-align": "center",
               padding: "0 0 0 0"
            }
         }
      }
    }
  });
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
